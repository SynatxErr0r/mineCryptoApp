//
//  MarketDataModel.swift
//  mineCrypto
//
//  Created by 博滔张 on 2025/5/22.
//

import Foundation

// JSON data:
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
   "data": {
     "active_cryptocurrencies": 17161,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1272,
     "total_market_cap": {
       "btc": 32556564.71290652,
       "eth": 1377482842.167867,
       "ltc": 36620649230.36286,
       "bch": 8680802103.826107,
       "bnb": 5289965622.475018,
       "eos": 4721687871663.942,
       "xrp": 1500267231871.8628,
       "xlm": 12112278763827.387,
       "link": 221171991016.81985,
       "dot": 750241835743.8702,
       "yfi": 616889080.2813497,
       "usd": 3597989609864.6733,
       "aed": 13215235937552.457,
       "ars": 4121533797594004,
       "aud": 5589059492130.028,
       "bdt": 438688977694926.25,
       "bhd": 1356503248742.35,
       "bmd": 3597989609864.6733,
       "brl": 20311011146647.08,
       "cad": 4985165720031.119,
       "chf": 2970690915353.598,
       "clp": 3394329819133545.5,
       "cny": 25918118154660.188,
       "czk": 79180953746302.28,
       "dkk": 23711334403325.008,
       "eur": 3178356081666.1577,
       "gbp": 2681211063302.326,
       "gel": 9858491531029.21,
       "hkd": 28160439249372,
       "huf": 1280002099245412.5,
       "idr": 58730135941947470,
       "ils": 12797329444366.676,
       "inr": 308268895602998.56,
       "jpy": 515715442058219.9,
       "krw": 4963499324610501,
       "kwd": 1103712096742.868,
       "lkr": 1079060564478609.8,
       "mmk": 7548582201496087,
       "mxn": 69648112656872.3,
       "myr": 15338229706853.111,
       "ngn": 5732928704670076,
       "nok": 36621856600818.02,
       "nzd": 6076144531544.677,
       "php": 200087825380111.72,
       "pkr": 1015215109565046.9,
       "pln": 13481598706360.35,
       "rub": 288088714554545.4,
       "sar": 13495418584451.838,
       "sek": 34459162614162.12,
       "sgd": 4640866898283.948,
       "thb": 117862943639947.02,
       "try": 139744139040276.72,
       "twd": 108063099339558.6,
       "uah": 149236527932522.97,
       "vef": 360266699635.7497,
       "vnd": 93457780116234930,
       "zar": 64661993469594.586,
       "xdr": 2591286508982.9785,
       "xag": 107451117286.81671,
       "xau": 1081555676.7253213,
       "bits": 32556564712906.52,
       "sats": 3255656471290652
     },
     "total_volume": {
       "btc": 1796881.600826362,
       "eth": 76026865.74496606,
       "ltc": 2021189010.3463092,
       "bch": 479116077.45875543,
       "bnb": 291966980.54144067,
       "eos": 260602251381.71457,
       "xrp": 82803656007.49457,
       "xlm": 668508211684.0536,
       "link": 12207058231.752146,
       "dot": 41407800936.8084,
       "yfi": 34047715.04251541,
       "usd": 198582417615.06378,
       "aed": 729383290779.2488,
       "ars": 227478184918715.25,
       "aud": 308474750204.55835,
       "bdt": 24212387254507.895,
       "bhd": 74868947341.97853,
       "bmd": 198582417615.06378,
       "brl": 1121017605678.797,
       "cad": 275144280067.2107,
       "chf": 163960168851.1303,
       "clp": 187341903328007.1,
       "cny": 1430488445290.1125,
       "czk": 4370203065872.292,
       "dkk": 1308690302434.9246,
       "eur": 175421750248.61896,
       "gbp": 147983021859.49277,
       "gel": 544115824265.275,
       "hkd": 1554247986684.0847,
       "huf": 70646649652240.44,
       "idr": 3241469166624952.5,
       "ils": 706317942973.2592,
       "inr": 17014163241753.113,
       "jpy": 28463678439914.824,
       "krw": 273948455273321.9,
       "kwd": 60916745262.76175,
       "lkr": 59556162991615,
       "mmk": 416625912156403.94,
       "mxn": 3844060737642.938,
       "myr": 846556846293.0173,
       "ngn": 316415266755314.25,
       "nok": 2021255648266.3535,
       "nzd": 335358242154.0328,
       "php": 11043368216068.24,
       "pkr": 56032366047980.76,
       "pln": 744084545737.7096,
       "rub": 15900366489943.639,
       "sar": 744847300803.769,
       "sek": 1901890934356.6204,
       "sgd": 256141531360.79,
       "thb": 6505162836234.262,
       "try": 7712843000454.779,
       "twd": 5964283905376.112,
       "uah": 8236752666562.886,
       "vef": 19884057475.796333,
       "vnd": 5158178297551283,
       "zar": 3568863833235.0605,
       "xdr": 143019851496.03946,
       "xag": 5930507021.963965,
       "xau": 59693874.7350882,
       "bits": 1796881600826.3618,
       "sats": 179688160082636.2
     },
     "market_cap_percentage": {
       "btc": 61.02636688614624,
       "eth": 8.766713049047206,
       "usdt": 4.2217521519094925,
       "xrp": 3.912087863306439,
       "bnb": 2.7578920883891365,
       "sol": 2.54360002351277,
       "usdc": 1.6974369847091422,
       "doge": 0.9870277473084536,
       "ada": 0.7892605479396442,
       "trx": 0.7174773316471991
     },
     "market_cap_change_percentage_24h_usd": 0.3247407417013488,
     "updated_at": 1747897211
   }
 }
 
 
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
    
}
